{
  "comments": [
    {
      "key": {
        "uuid": "88c5b0a3_ea413f70",
        "filename": "vndk/snapshot/build.sh",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1074628
      },
      "writtenOn": "2017-11-21T18:31:27Z",
      "side": 1,
      "message": "Add:\n\n -e\n\nOtherwise this script won\u0027t fail when the aosp_arm64_ab build fails.",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 1,
        "endChar": 11
      },
      "revId": "e242d62a9e76ed0f252bc7531bf81e717df9d93b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c76dc94d_e1f53d1d",
        "filename": "vndk/snapshot/build.sh",
        "patchSetId": 2
      },
      "lineNbr": 18,
      "author": {
        "id": 1074628
      },
      "writtenOn": "2017-11-21T18:31:27Z",
      "side": 1,
      "message": "If you ever want to ship with snapshots built from this script, then this should be \u0027user\u0027",
      "range": {
        "startLine": 18,
        "startChar": 21,
        "endLine": 18,
        "endChar": 9
      },
      "revId": "e242d62a9e76ed0f252bc7531bf81e717df9d93b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d92d7445_43929db1",
        "filename": "vndk/snapshot/build.sh",
        "patchSetId": 2
      },
      "lineNbr": 18,
      "author": {
        "id": 1135414
      },
      "writtenOn": "2017-11-22T05:10:28Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "c76dc94d_e1f53d1d",
      "range": {
        "startLine": 18,
        "startChar": 21,
        "endLine": 18,
        "endChar": 9
      },
      "revId": "e242d62a9e76ed0f252bc7531bf81e717df9d93b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1f5c1b27_6fcac3e2",
        "filename": "vndk/snapshot/build.sh",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1074628
      },
      "writtenOn": "2017-11-21T18:31:27Z",
      "side": 1,
      "message": "If you\u0027re going to build like the build servers normally do, don\u0027t pick up envsetup. But if you do, change \u0027make -j\u0027 below with just \u0027m\u0027.",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 24
      },
      "revId": "e242d62a9e76ed0f252bc7531bf81e717df9d93b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7821679b_b8669846",
        "filename": "vndk/snapshot/build.sh",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1135414
      },
      "writtenOn": "2017-11-22T05:10:28Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "1f5c1b27_6fcac3e2",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 24
      },
      "revId": "e242d62a9e76ed0f252bc7531bf81e717df9d93b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7cc4e095_b9cae328",
        "filename": "vndk/snapshot/build.sh",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1074628
      },
      "writtenOn": "2017-11-21T18:31:27Z",
      "side": 1,
      "message": "We\u0027d need a separate arm snapshot due to the arm64 devices using armv8 instructions in 32-bit builds.",
      "range": {
        "startLine": 23,
        "startChar": 40,
        "endLine": 23,
        "endChar": 50
      },
      "revId": "e242d62a9e76ed0f252bc7531bf81e717df9d93b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f2419c08_fbe2cd72",
        "filename": "vndk/snapshot/build.sh",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1135414
      },
      "writtenOn": "2017-11-22T05:10:28Z",
      "side": 1,
      "message": "It appears that currently build/make/core/combo/arch/armv8-a.mk and ./armv7-a-neon.mk is the same, and therefore covering the \u0027arm\u0027 part of the snapshot with the \u0027arm64\u0027 build will work. Nonetheless, I guess we could either 1) offer one flavor of \u0027arm\u0027 built with the armv7 variant since v7 supports v8, or 2) offer two flavors of \u0027arm\u0027 builds, one with the armv8 variant and second with the armv7 variant. If we go with 2) then in the Android.bp in the snapshot (go/vndk-snapshot-dir) will need additional key options under arch to differentiate arm-armv7-a-neon and arm-armv8-a, and this will probably require changes in build/soong, is that correct?",
      "parentUuid": "7cc4e095_b9cae328",
      "range": {
        "startLine": 23,
        "startChar": 40,
        "endLine": 23,
        "endChar": 50
      },
      "revId": "e242d62a9e76ed0f252bc7531bf81e717df9d93b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ceb82e7f_c1b44656",
        "filename": "vndk/snapshot/build.sh",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1074628
      },
      "writtenOn": "2017-11-22T05:44:58Z",
      "side": 1,
      "message": "Those mk files are completely irrelevant for all of these binaries, since these are all in Soong. Even for make libraries, the important compile flags are all controlled by the Soong configuration: https://android.googlesource.com/platform/build/soong/+/master/cc/config/arm_device.go#65\n\nFor production use, you probably actually care about the cpu variants as well. https://android.googlesource.com/platform/build/soong/+/master/android/arch.go#924 attempts to list all of the available configurations, but there are configs that don\u0027t make much sense for this use case, and it is not completely up to date (missing 32-bit armv8).\n\nIt may mostly work to share the v7 binaries with v8, but you should probably just be assuming that you\u0027ve got one set of libraries for \"arm\" (armv7-a-neon), and another set for \"arm64\" (armv8-a 32 + 64-bit). x86 is similar -- we adjust the set of expected cpu features for 32-bit platform code when we know we\u0027re also building for 64-bit.\n\nFor the definitions in Soong, you should be able to define prebuilts using the associated arch variables, so instead of:\n\n  arch: {\n      arm: {\n          srcs: [...],\n      },\n      arm64: {\n          srcs: [...],\n      },\n  },\n\nYou can specify:\n\n  arch: {\n      arm: {\n          armv7-a-neon: {\n              srcs: [...],\n          },\n          armv8-a: {\n              srcs: [...],\n          },\n      },\n      arm64: {\n          srcs: [...],\n      },\n  },\n\nOr even down to the cpu variant:\n\n  arch: {\n      arm: {\n          armv7-a-neon: {\n              srcs: [...],\n          },\n          armv8-a: {\n              srcs: [...],\n          },\n          cortex-a53: {\n              srcs: [...],\n              exclude_srcs: [...],\n          },\n      },\n      arm64: {\n          srcs: [...],\n      },\n  },",
      "parentUuid": "f2419c08_fbe2cd72",
      "range": {
        "startLine": 23,
        "startChar": 40,
        "endLine": 23,
        "endChar": 50
      },
      "revId": "e242d62a9e76ed0f252bc7531bf81e717df9d93b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "329d5b6a_3e33f427",
        "filename": "vndk/snapshot/build.sh",
        "patchSetId": 2
      },
      "lineNbr": 24,
      "author": {
        "id": 1074628
      },
      "writtenOn": "2017-11-21T18:31:27Z",
      "side": 1,
      "message": "Why aren\u0027t you just exporting TARGET_BUILD_VARIANT above?",
      "range": {
        "startLine": 24,
        "startChar": 47,
        "endLine": 24,
        "endChar": 89
      },
      "revId": "e242d62a9e76ed0f252bc7531bf81e717df9d93b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a275733a_afc256f8",
        "filename": "vndk/snapshot/build.sh",
        "patchSetId": 2
      },
      "lineNbr": 24,
      "author": {
        "id": 1135414
      },
      "writtenOn": "2017-11-22T05:10:28Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "329d5b6a_3e33f427",
      "range": {
        "startLine": 24,
        "startChar": 47,
        "endLine": 24,
        "endChar": 89
      },
      "revId": "e242d62a9e76ed0f252bc7531bf81e717df9d93b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}